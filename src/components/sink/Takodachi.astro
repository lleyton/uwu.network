---
import takodachi from "^/takodachi.gif";
---

<style>
  * {
    filter: grayscale() brightness(1.5) contrast(3) invert();
  }
</style>

<img src={takodachi} id="takodachi" class="absolute w-10 h-10 -z-1 pointer-events-none transition-opacity duration-500 opacity-0">

<script>
  /* 
  I spent a god-damn age writing this wretched thing.
  If you steal please credit thanks.
  Mobile users cry.
  -- sink
  */

  let currentTarget;
  window.addEventListener("mousemove", e => {
    currentTarget = [e.clientX, e.clientY];
  });

  const chaser = document.getElementById("takodachi");
  setTimeout(() => {
    chaser.classList.remove("opacity-0");
  }, 1000)

  let targetX;
  let targetY;

  const speed = 2;
  const offset = chaser.clientWidth / 2;

  const snapThreshold = 5; // px

  setInterval(() => {
    if (!currentTarget) return;
    if (!targetX || !targetY) {
      targetX = chaser.offsetLeft;
      targetY = chaser.offsetTop;
    }

    const diffX = currentTarget[0] - (chaser.offsetLeft + offset);
    const diffY = currentTarget[1] - (chaser.offsetTop + offset);

    if (Math.abs(diffX) < snapThreshold && Math.abs(diffY) < snapThreshold) {
      targetX = currentTarget[0];
      targetY = currentTarget[1];
    } else {

      const vecLength = Math.sqrt(diffX * diffX + diffY * diffY);

      const coeffX = diffX / vecLength;
      const coeffY = diffY / vecLength;

      targetX += speed * coeffX;
      targetY += speed * coeffY;
    }

    chaser.style.left = (targetX - offset) + "px";
    chaser.style.top = (targetY - offset) + "px";
  }, 10);
</script>